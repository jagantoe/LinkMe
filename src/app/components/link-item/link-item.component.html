<div
    [class]="viewMode() === 'compact' ? 'bg-white rounded-lg shadow-md p-3 transition-all hover:translate-y-[-2px] hover:shadow-lg flex flex-row items-center' : 'bg-white rounded-lg shadow-md p-5 transition-all hover:translate-y-[-3px] hover:shadow-lg'">
    @if (isEditing()) {
        <!-- Edit Link Form -->
        <div class="mb-3 w-full">
            <h3 class="text-lg font-medium text-gray-900 m-0 mb-3">Edit Link</h3>
            <div class="mb-3">
                <label for="editLinkName" class="block mb-2 text-sm font-medium">Name</label>
                <input type="text" id="editLinkName" #editNameInput [value]="item().link.name"
                    class="w-full p-2 border border-gray-300 rounded text-sm focus:outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-200"
                    placeholder="Enter link name">
            </div>
            <div class="mb-3">
                <label for="editLinkUrl" class="block mb-2 text-sm font-medium">URL</label>
                <input type="url" id="editLinkUrl" #editUrlInput [value]="item().link.url"
                    class="w-full p-2 border border-gray-300 rounded text-sm focus:outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-200"
                    placeholder="https://example.com">
            </div>
            <div class="mb-3">
                <label for="editLinkTags" class="block mb-2 text-sm font-medium">Tags</label> <input type="text"
                    id="editLinkTags" #editTagsInput [value]="formatTags(item().link.tags)"
                    class="w-full p-2 border border-gray-300 rounded text-sm focus:outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-200"
                    placeholder="tag1, tag2, tag3">
            </div>
            <div class="flex justify-end gap-2 mt-4">
                <button class="px-3 py-1.5 bg-gray-100 text-gray-700 rounded text-sm cursor-pointer hover:bg-gray-200"
                    (click)="cancelEdit()">Cancel</button>
                <button
                    class="px-3 py-1.5 bg-blue-400 text-white rounded text-sm cursor-pointer hover:bg-blue-500 disabled:bg-gray-400 disabled:cursor-not-allowed"
                    (click)="saveEditedLink(editNameInput, editUrlInput, editTagsInput)"
                    [disabled]="!editNameInput?.value || !editUrlInput?.value">
                    Save
                </button>
            </div>
        </div>
    } @else {
        <!-- Link Display -->
        @if (viewMode() === 'compact') {
            <!-- Compact View -->
            <div class="flex-1">
                <div class="flex justify-between items-start">
                    <h3 class="text-base font-medium text-gray-900 m-0 break-words" [title]="item().link.name">
                        {{ item().link.name }}
                    </h3>
                </div>
                <div class="flex flex-wrap gap-1 mt-1 min-h-[1.5rem]"> @if (item().link.tags.length > 0) {
                        @for (tag of item().link.tags; track tag) {
                            <span [style.backgroundColor]="settings().defaultTagColor + '15'"
                                [style.color]="settings().defaultTagColor"
                                class="py-0.5 px-1.5 rounded text-xs font-medium">{{ tag }}</span>
                        }
                    }
                </div>
            </div>
            <div class="flex items-center gap-1 ml-3">
                <a [href]="item().link.url" target="_blank" title="Open link"
                    class="w-6 h-6 rounded-full bg-blue-50 border-none text-blue-400 flex items-center justify-center hover:bg-blue-100">
                    ↗
                </a>
                <button
                    class="w-6 h-6 rounded-full bg-gray-100 border-none text-sm text-blue-400 flex items-center justify-center hover:bg-blue-50 hover:text-blue-500"
                    (click)="startEdit()" title="Edit link">✎</button>
                <button
                    class="w-6 h-6 rounded-full bg-gray-100 border-none text-base text-gray-400 flex items-center justify-center hover:bg-red-500 hover:text-white"
                    (click)="deleteLink()" title="Delete link">×</button>
            </div>
        } @else {
            <!-- Detailed View -->
            <div class="flex justify-between items-start mb-3">
                <h3 class="text-lg font-medium text-gray-900 m-0 break-words" [title]="item().link.name">
                    {{ item().link.name }}
                </h3>
                <div class="flex">
                    <button
                        class="w-6 h-6 rounded-full bg-gray-100 border-none text-sm text-blue-400 flex items-center justify-center ml-2 flex-shrink-0 hover:bg-blue-50 hover:text-blue-500"
                        (click)="startEdit()" title="Edit link">✎</button>
                    <button
                        class="w-6 h-6 rounded-full bg-gray-100 border-none text-base text-gray-400 flex items-center justify-center ml-2 flex-shrink-0 hover:bg-red-500 hover:text-white"
                        (click)="deleteLink()" title="Delete link">×</button>
                </div>
            </div>

            <div class="flex items-center mb-4 bg-gray-50 rounded p-2">
                <a [href]="item().link.url" target="_blank"
                    class="flex-1 text-sm text-blue-400 no-underline whitespace-nowrap overflow-hidden text-ellipsis hover:underline"
                    [title]="item().link.url">
                    {{ item().link.url }}
                </a>
                <button
                    class="bg-transparent border border-gray-300 rounded px-2.5 py-1.5 text-xs text-gray-700 cursor-pointer ml-2 flex-shrink-0 hover:bg-gray-100"
                    #copyBtn (click)="copyToClipboard(item().link.url, copyBtn)" title="Copy link to clipboard"> Copy
                </button>
            </div>
            <div class="flex flex-wrap gap-2 mt-2 min-h-[2rem]"> @if (item().link.tags.length > 0) {
                    @for (tag of item().link.tags; track tag) {
                        <span [style.backgroundColor]="settings().defaultTagColor + '15'"
                            [style.color]="settings().defaultTagColor"
                            class="py-1.5 px-2.5 rounded text-xs font-medium">{{ tag }}</span>
                    }
                }
            </div>
        }

        @if (showMatchType() && item().matchType !== 'name') {
            <div class="mt-3 text-xs text-gray-400 italic">
                Matched by {{ item().matchType }}
            </div>
        }
    }
</div>
